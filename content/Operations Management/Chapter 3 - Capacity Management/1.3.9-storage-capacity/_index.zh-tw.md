---
title: "9. 存儲容量"
date: 2021-06-14T11:51:44+10:00
draft: false
weight: 90
---

存儲容量不同於計算容量，這本身就是一個挑戰。與 vSphere 集群的基本計算能力不同，存儲的形狀各不相同。兩個主要是數據存儲和 vSAN，因為很少使用本地數據存儲和 RDM。我們將單獨討論 vSAN 容量，因為它有其獨特的因素，例如 FTT，需要考慮計算。

## 數據存儲容量

與計算能力類似，存儲能力由兩個因素驅動：

#### 爭用

如果數據存儲無法為現有虛擬機提供服務，這意味著它們的延遲越來越嚴重，您是否要添加更多虛擬機？你是對的，不管剩餘空間如何，數據存儲都已滿。

這裡的關鍵計數器是延遲和未完成的 IO。

#### 利用率

還剩多少磁盤空間？精簡配置使這具有挑戰性。它要求我們同時使用需求模型和分配模型來正確回答數據存儲的剩餘容量。

-----

看看下面的兩個數據存儲。

哪個剩餘容量較低？您會選擇哪一個來部署額外的 VM？

![數據存儲對比](1.3.9-fig-1.png)

兩者都具有相同的 10 TB 可用物理容量，如黑線所示。兩者都有相同的分配模型，基於 2:1 的過量使用。但它們有不同的使用率和實際過度使用率。數據存儲 1 使用了 5 TB，但已使用 25 TB 進行精簡配置。數據存儲 2 實際使用了 8 TB，但使用 12 TB 進行了精簡配置。紅色箭頭表示風險。

|       | 總容量 | 已用容量 |
| ------ | ----------| ----------| ------|
| **需求模型** | 10 TB | 數據存儲 1 = 5 TB<br />數據存儲 2 = 8 TB | 數據存儲 1 = 50%<br />數據存儲 2 = **80%**|
| **分配模型** | 20 TB | 數據存儲 1 = 25TB<br />數據存儲 2 = 12 TB | 數據存儲 1 = **125%**<br />數據存儲 2 = 60% |

數據存儲 1 的實際使用率較低，但風險較高，因為它的空間多於可回收和過度使用的空間。您應該使用兩個容量模型中較低的一個。在這種情況下，您應該選擇 Datastore 2。

精簡配置以新配置的 VM 的形式帶來了另一種複雜性，因為它們的增長是不可預測的。它們可能會閒置數月並突然增加其存儲消耗。隨著它們的成熟，它們的增長變得相對更可預測，具體取決於業務應用程序。

最後是複墾。我添加了一個綠色箭頭來表示您可以擁有不同的可恢復值。在上面的示例中，數據存儲 1 恰好具有更多可回收空間。

## 容量匯總

現在我們知道瞭如何計算單個數據存儲的容量，我們可以解決聚合問題。

數據存儲可能屬於一個數據存儲集群。由於數據存儲集群將數據存儲分組到一個更大的池中，我們可以將它們視為一個邏輯池。這簡化了容量計算。

它還可以在具有許多數據存儲的大型環境中簡化容量管理，因為您可以將集群視為一個整體。它使信息和可視化更緊湊，更易於管理。從數據存儲集群，構建一個向下鑽取。

對於過度使用率，我們應該在數據存儲集群級別允許較低的過度使用率，以說明數據存儲之間的分佈不是粒度的事實。下圖說明了原因。

![具有 3 個成員的數據存儲集群](1.3.9-fig-2.png)

將其匯總到數據中心或 vSphere 怎麼樣？

這是不可取的。 vCenter 中的不同數據存儲可能有不同的用途，例如 NSX Edge 和業務工作負載。它們的容量不可互換。是的，這意味著我們甚至不應該計算總容量。如果您在全球擁有 1,000 個數據存儲，並且每個數據存儲有 1 TB 的可用空間，那麼您沒有 1 PB 的空間。

那麼你可以捲起什麼？

您可以總結 VM Remaining。這只是每個數據存儲上剩餘的虛擬機總數。