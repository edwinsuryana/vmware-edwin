---
title: "3. 可用性状态"
date: 2021-06-14T14:26:05+10:00
draft: false
weight: 30
---

你能发现上述计算的局限性吗？

提示：它在 1 个月内测量。

一个典型的月份允许 99.9% 的停机时间是多少分钟？

大约43分钟，如果发生在高峰时段，这是一个很长的时间。您可能会失去很多业务，更不用说客户的不满了。

上述计算的问题在于它是按月计算的。它没有考虑到所有组件同时关闭与不同时间之间存在很大差异。查看下表，其中每 5 分钟记录一次正常运行时间。

![SLA 包括停机时间](1.7.3-fig-1.png)

上述系统有 3 层：Web、应用程序和数据库。

Web 层的大小为 8 个虚拟机，另外还有 2 个虚拟机以提高灵活性。应用层设计为3+1服务器组。数据库采用主动/被动设计。

让我们逐步展示不同的场景如何影响可用性。

#### 9:00 - 9:05 am

- 1 个 Web 服务器已关闭。所有其他服务器都已启动。为简单起见，我们假设停机时间恰好为 300 秒。
- Web 层的正常运行时间变为 9/10 = 90%。
- 总体而言，系统正常运行时间为 90%。
- SLA 不受影响，因为 Web 层旨在处理 2 个故障。
- 尽管 SLA 不受影响，但重要的是要记录正常运行时间并不完美的事实。

#### 9:05 - 9:10 am

- 1 个 Web 服务器 + 1 个应用程序服务器已关闭。所有其他服务器都在线。
- Web 层的正常运行时间变为 9/10 = 90%。
- 应用层的正常运行时间变为 3/4 = 75%。
- 总体而言，系统正常运行时间为 68%。
- SLA 不受影响，因为两个层都没有违反它们的阈值。

#### 9:10 - 9:15 am

- 3 个 Web 服务器已关闭。所有其他服务器都已启动。 Web 层的正常运行时间变为 7/10 = 70%。
- 总体而言，系统正常运行时间为 70%。这比之前的 68% 高，但这次 SLA 受到影响，因为 Web 层不是设计来处理 3 次故障的。
- 从这里您可以看到正常运行时间和 SLA 可能会有所不同。 - 前者是绝对的和技术性的，而SLA是相对于设计和任何合同的。

#### 9:15 - 9:20 am

- 与之前相同，但 1 个应用程序服务器已关闭。反映这种退化很重要，因此正常运行时间从 70% -> 53% 减少。
- SLA 不关心它，因为它只关心系统是在运行还是出现故障。 在那5分钟里它是二进制的。

我们现在可以继续整个月的日程安排。我正在稍微修改示例以说明 SLA 和现实可能不同的观点。

从上午 9:00 到上午 9:30，系统从未有 100% 的正常运行时间。在本月剩余的时间里，它具有完美的 100% 正常运行时间。

SLA 仅经历了 5 分钟的中断。 所有其他停机时间都不会影响 SLA，因为系统已设计用于处理故障或计划停机。

SLA 基于日历月。以2021年2月为例，有28天。这在 5 分钟内转化为 8064 次。

#### SLA

- (8064 - 1) / 8064 = 99.988%
- 如果 SLA 为 99.95，那么您将通过 2021 年 2 月。

#### 现实

- 平均值 (34% + 3.75% + 0 + 0% + 34% + 34% + 100% + 100% + 100% + ...)
- 是的，我们只是对构成 2021 年 2 月的所有 8064 个数字求平均值。
- 结果是 99.939%

现实与 SLA 之间的差距提供了有价值的输入。