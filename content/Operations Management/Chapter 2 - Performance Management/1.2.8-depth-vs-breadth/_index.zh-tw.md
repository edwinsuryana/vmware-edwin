---
title: "8. 深度和廣度"
date: 2021-06-13T15:30:22+10:00
draft: false
weight: 80
---

您從以下屏幕截圖中註意到了什麼？

![CPU爭用示例](1.2.8-fig-1.png)

請注意，最大值比平均值高出 10 倍以上。平均值相對於最大值也非常穩定。即使最大值變得更糟，它也沒有移動。一旦集群無法應對，您就會看到這樣的模式。幾乎所有的 VM 都可以服務，但 1-2 服務不好。最大值很高，因為始終有一個 VM 未提供服務。

***小心*** 當您查看集群和數據存儲等父對象的計數器時，average 是聚合中使用的默認計數器。查看以下集群級別圖表。你注意到一個問題嗎？

![集群級別圖表](1.2.8-fig-2.png)

這是正確的。在過去 7 天內完全沒有性能問題。集群運行良好。

這個集群運行了 100 多個虛擬機。您在上面看到的是在集群級別聚合的所有這些 VM 的平均體驗。如果只有少數虛擬機有問題，但大多數都沒有，則上述內容無法顯示。

您需要的是一個集群級別的指標，用於跟踪是否有任何 VM 發生爭用。我們有這個，結果很明顯。

![集群圖表中最差的虛擬機](1.2.8-fig-3.png)

相同的模式，但比例是 6000%！

下圖解釋了這種事情是如何發生的。

![磁盤組延遲圖表](1.2.8-fig-4.png)

上圖顯示了 6 個具有不同磁盤延遲的對象。粗紅線顯示 6 個對像中最差的延遲隨時間變化。

繪製所有 6 個對像中的最大值，並取平均值，給我們兩個不同的結果，如下所示：

![SLA 和指標](1.2.8-fig-5.png)

該圖表顯示平均值可能仍遠低於閾值，但一個或多個對象受到影響。平均數是穩定的。
只有當集群無法為大約 50% 的虛擬機提供服務時，平均數量才會變高。因此，平均值是一種糟糕的匯總技術。這是一個滯後指標。

主動監控需要從多個角度進行洞察。當您聽說 VM 遇到性能問題時，您的下一個問題自然是：

- 有多糟糕？您想衡量問題的深度。嚴重性還可以提供根本原因的線索。
- 問題持續了多久？有什麼模式嗎？
- 有多少虛擬機受到影響？還有誰受到影響？您想衡量問題的廣度。

注意你沒有問 “什麼是 _平均_ 性能？”​​。顯然，在這種情況下，平均為時已晚。當平均表現不佳時，可能有一半的人口受到影響。

第三個問題的答案會影響故障排除的過程。事件是孤立的還是普遍存在的？如果它是孤立的，那麼您將更仔細地觀察受影響的對象。如果這是一個普遍存在的問題，那麼您將查看在受影響的 VM 之間共享的公共區域（例如集群、數據存儲、資源池、主機）。

在計算問題的廣度時，需要使用嚴格的閾值。沒有這個，您將無法捕捉剛好低於閾值的值。另一方面，如果設置得太低，則會收到很多預警。

![示例指標](1.2.8-fig-6.png)