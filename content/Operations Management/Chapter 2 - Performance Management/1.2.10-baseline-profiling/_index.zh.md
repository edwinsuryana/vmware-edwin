---
title: "10. 基线分析"
date: 2021-06-13T22:26:52+10:00
draft: false
weight: 100
---

您如何分析您的环境以设置阈值？你如何确定什么是可以接受的？最近几个月的实际价值是多少？

以上所有问题都可以通过分析您的环境来回答。

假设您在 10 个集群中有 5000 个虚拟机。所有这些集群都提供相同级别的服务。您想证明 5% 的 CPU Ready for VM 是否是一个很好的阈值，或者您想知道这些 VM 在过去 3 个月内经历的实际 CPU Ready。

您希望至少分析最近 3 个月的数据，以便不排除该期间内的任何峰值。由于 vRealize Operations 每 5 分钟存储一次此计数器，因此您一天将拥有 288 个数据点，3 个月内将拥有 26,298 个数据点。

#### 步 1

对于每个集群，您可以测量任何 VM 所经历的最差 CPU Ready。

一个拥有 500 个虚拟机的集群将用任何在 5 分钟间隔内遇到最高 CPU 就绪状态的虚拟机来表示。因此，您每 5 分钟分析 500 个指标并取最坏的结果。

#### 步 2

你做上述3个月。

由于 3 个月内有 26,298 个数据点，这意味着您分析了 13,149,000 个数据点

#### 步 3

在 13+ 百万中取最差的可能会给你一个异常值。

为了解决这个问题，在比较第 100、99 和 95 的值后，取第 99 个百分位数。平均值不适用，因为您希望接近峰值。

您将此记录为过去 3 个月内为该集群准备的最差 CPU。

#### 步 4

您对每个集群重复步骤 1 - 3。

------

以上为您提供了问题的深度。正如[以前](/zh/operations-management/chapter-2-performance-management/1.2.4-contention-vs-utilization/)所涵盖的那样，您需要用问题的广度来补充这一点。该步骤是类似的，除了在步骤 1 中计算虚拟机体验 > 2.5% CPU 就绪的百分比。

为什么是 2.5% 而不是 5%？

为了让您获得更好的可见性，因为 >5% 的数字可能太小了。

对所有集群执行上述操作后，您可能会得到这样的结果。

![集群百分位细分](1.2.10-fig-1.png)

如果您想查看最近 3 个月 VM CPU Ready 的实际分布怎么办？您可以通过创建条形图并指定分布桶来实现。在下面的示例中，我指定 0% - 1%、1% - 2%，直到 5%，因为这些是我感兴趣的范围。

![第 99 个百分位细分](1.2.10-fig-2.png)

请注意，在这种情况下，我将值设置为第 99 个百分位数，因为取 Max 可能会给出异常值。

如果你想看更多的例子，我应用这个基线技术来计算 [CPU Context Switch](/zh/metrics/chapter-2-cpu-metrics/2.2.1-guest-os/#guest-os-cpu-context-switch) 和 [CPU 运行队列](/zh/metrics/chapter-2-cpu-metrics/2.2.1-guest-os/#guest-os-cpu-run-queue)。